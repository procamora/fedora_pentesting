FROM fedora:32
LABEL Maintainer "Pablo Rocamora <pablojoserocamora@gmail.com>"
LABEL Description="Fedora 32 with the main pentesting tools"
LABEL Version="1.0"
LABEL License=GPLv2


#RUN dnf -y upgrade
RUN dnf -yq install "https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm" \
	"https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm" && \
	dnf -yq group install "Development Tools" && \
	dnf -yq group install "C Development Tools and Libraries" && \
	dnf -yq install vim sudo tmux atop procps openvpn man-db man-pages-es dnf-utils glibc-langpack-en util-linux-user mlocate zsh iputils
	# dnf clean all


# Set the locale
#RUN sed -i -e 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen && \
#    locale-gen
ENV LANG en_US.UTF-8
ENV LANGUAGE en_US:en
ENV LC_ALL en_US.UTF-8
#localedef -i en_US -f UTF-8 en_US.UTF-8

USER root
WORKDIR /data
RUN chmod 777 /data

COPY ./fedora_pentesting.sh /data
COPY ./install.sh /data
COPY ./entrypoint.sh /data


RUN chmod +x ./*.sh
#RUN bash ./install.sh
#RUN echo "zsh" >> /root/.bashrc
RUN rm ./install.sh
RUN rm ./fedora_pentesting.sh

# Enable SSH and Add keys
RUN dnf -yq install openssh-server && ssh-keygen -A && mkdir /var/run/sshd
RUN mkdir -p /root/.ssh && chmod 700 /root/.ssh
COPY ./ssh/id_rsa /root/.ssh/id_rsa
COPY ./ssh/id_rsa.pub /root/.ssh/id_rsa.pub
COPY ./ssh/id_rsa.pub /root/.ssh/authorized_keys
RUN  chmod 600 /root/.ssh/*


RUN echo 'root:toor' | chpasswd
RUN chsh -s $(which zsh) root

RUN dnf clean all 


EXPOSE 22


ENTRYPOINT ["./entrypoint.sh"]

#ENTRYPOINT [ "zsh" ]
#CMD [ "-i" ]


#CMD [ "zsh", "-i" ]